<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>InfiltratorOS</title>
    <style>
        :root {
            --bg: #0a0a0c;
            --panel: #121216;
            --cyan: #00f0ff;
            --red: #ff003c;
            --dim: #3a3a40;
            --text: #c8c8cc;
            --font: 'Courier New', Courier, monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: var(--font);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            text-transform: uppercase;
        }

        /* Scanline Overlay for realism */
        body::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 100;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        header {
            padding: 15px;
            background: var(--panel);
            border-bottom: 1px solid var(--dim);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 10;
        }

        .bar-container { width: 100%; background: var(--bg); border: 1px solid var(--dim); height: 14px; position: relative; }
        .bar-fill { height: 100%; width: 0%; transition: width 0.3s ease; }
        .bar-fill.cyan { background: var(--cyan); box-shadow: 0 0 8px var(--cyan); }
        .bar-fill.red { background: var(--red); box-shadow: 0 0 8px var(--red); }
        .bar-labels { display: flex; justify-content: space-between; font-size: 10px; margin-bottom: 2px; color: var(--cyan); font-weight: bold;}

        main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        #grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 400px;
        }

        .node {
            aspect-ratio: 1;
            background: var(--panel);
            border: 1px solid var(--dim);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--dim);
            transition: all 0.2s;
        }

        .node:active { transform: scale(0.9); }
        .node.safe { background: rgba(0, 240, 255, 0.1); border-color: var(--cyan); color: var(--cyan); box-shadow: inset 0 0 10px rgba(0,240,255,0.2); }
        .node.danger { background: rgba(255, 0, 60, 0.1); border-color: var(--red); color: var(--red); box-shadow: inset 0 0 10px rgba(255,0,60,0.2); }

        footer {
            height: 35vh;
            background: var(--panel);
            border-top: 1px solid var(--dim);
            padding: 10px;
            overflow-y: hidden;
            position: relative;
        }

        #terminal {
            height: 100%;
            overflow-y: auto;
            font-size: 11px;
            line-height: 1.4;
            color: var(--text);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding-bottom: 20px;
        }

        .log-cyan { color: var(--cyan); }
        .log-red { color: var(--red); }
        .log-sys { color: #888; }

        /* Hide scrollbar for aesthetics */
        ::-webkit-scrollbar { width: 0px; }
        
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10,10,12,0.9); z-index: 50;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            display: none; text-align: center;
        }
        
        #overlay h1 { font-size: 32px; margin-bottom: 15px; }
        .btn { background: transparent; color: var(--cyan); border: 1px solid var(--cyan); padding: 10px 20px; font-family: var(--font); cursor: pointer; text-transform: uppercase; font-weight: bold;}
        .btn:active { background: var(--cyan); color: #000; }
    </style>
</head>
<body>

    <header>
        <div>
            <div class="bar-labels"><span>Data Extraction</span><span id="data-val">0%</span></div>
            <div class="bar-container"><div id="data-bar" class="bar-fill cyan"></div></div>
        </div>
        <div>
            <div class="bar-labels"><span style="color:var(--red)">Active Trace</span><span id="trace-val" style="color:var(--red)">0%</span></div>
            <div class="bar-container"><div id="trace-bar" class="bar-fill red"></div></div>
        </div>
    </header>

    <main>
        <div id="grid"></div>
    </main>

    <footer>
        <div id="terminal"></div>
    </footer>

    <div id="overlay">
        <h1 id="overlay-title">SYSTEM BREACHED</h1>
        <button class="btn" onclick="Game.init()">Initialize Sequence</button>
    </div>

    <script>
        // --- MODULE: Terminal System ---
        const Terminal = {
            el: document.getElementById('terminal'),
            jargon: [
                "Bypassing subnet firewalls...", "Decrypting RSA-2048 keys...",
                "Injecting payload into memory...", "Rerouting IP via proxy chain...",
                "Scanning ports 1-65535...", "Analyzing packet headers...",
                "Allocating virtual memory block...", "Buffer overflow successful."
            ],
            log(msg, type = 'sys') {
                const line = document.createElement('div');
                const timestamp = new Date().toISOString().substring(11, 19);
                
                let cssClass = 'log-sys';
                if(type === 'success') cssClass = 'log-cyan';
                if(type === 'error') cssClass = 'log-red';

                line.className = cssClass;
                line.innerHTML = `[${timestamp}] ${msg}`;
                this.el.appendChild(line);
                
                // Keep terminal from getting too long
                if(this.el.children.length > 20) this.el.removeChild(this.el.firstChild);
                this.el.scrollTop = this.el.scrollHeight;
            },
            randomLog() {
                const text = this.jargon[Math.floor(Math.random() * this.jargon.length)];
                this.log(text, 'sys');
            }
        };

        // --- MODULE: Game Logic ---
        const Game = {
            data: 0,
            trace: 0,
            nodes: [],
            gridSize: 25, // 5x5 grid
            isPlaying: false,
            autoLogger: null,

            elements: {
                dataBar: document.getElementById('data-bar'),
                dataVal: document.getElementById('data-val'),
                traceBar: document.getElementById('trace-bar'),
                traceVal: document.getElementById('trace-val'),
                grid: document.getElementById('grid'),
                overlay: document.getElementById('overlay'),
                overlayTitle: document.getElementById('overlay-title')
            },

            init() {
                this.data = 0;
                this.trace = 0;
                this.isPlaying = true;
                this.updateUI();
                this.elements.overlay.style.display = 'none';
                Terminal.el.innerHTML = ''; // clear terminal
                Terminal.log("INITIALIZING INFILTRATION PROTOCOL...", "sys");
                
                this.generateGrid();
                
                if(this.autoLogger) clearInterval(this.autoLogger);
                this.autoLogger = setInterval(() => Terminal.randomLog(), 3500);
            },

            generateGrid() {
                this.elements.grid.innerHTML = '';
                this.nodes = [];

                for(let i=0; i < this.gridSize; i++) {
                    const node = document.createElement('div');
                    node.className = 'node';
                    node.innerHTML = '0x' + Math.floor(Math.random()*16).toString(16).toUpperCase();
                    
                    // 30% chance of a node being a trap (ICE)
                    const isTrap = Math.random() < 0.3;
                    
                    node.onclick = () => this.handleNodeClick(node, isTrap);
                    this.elements.grid.appendChild(node);
                    this.nodes.push({ el: node, isTrap: isTrap, clicked: false });
                }
            },

            handleNodeClick(nodeEl, isTrap) {
                if(!this.isPlaying) return;
                if(nodeEl.classList.contains('safe') || nodeEl.classList.contains('danger')) return; // already clicked

                if(isTrap) {
                    nodeEl.classList.add('danger');
                    nodeEl.innerHTML = 'ICE';
                    this.trace += 20; // +20% trace
                    Terminal.log("WARNING: ICE ENCOUNTERED. TRACE SPIKED.", "error");
                } else {
                    nodeEl.classList.add('safe');
                    nodeEl.innerHTML = 'DAT';
                    this.data += 10; // +10% data
                    Terminal.log(`DATA NODE ACCESSED. EXTRACTING...`, "success");
                }

                this.updateUI();
                this.checkWinLoss();
            },

            updateUI() {
                this.elements.dataBar.style.width = `${this.data}%`;
                this.elements.dataVal.innerText = `${this.data}%`;
                this.elements.traceBar.style.width = `${this.trace}%`;
                this.elements.traceVal.innerText = `${this.trace}%`;
            },

            checkWinLoss() {
                if(this.trace >= 100) {
                    this.endGame("CONNECTION TERMINATED", "error");
                } else if (this.data >= 100) {
                    this.endGame("MAINFRAME BREACHED", "success");
                }
            },

            endGame(message, type) {
                this.isPlaying = false;
                clearInterval(this.autoLogger);
                Terminal.log(message, type);
                
                setTimeout(() => {
                    this.elements.overlay.style.display = 'flex';
                    this.elements.overlayTitle.innerText = message;
                    this.elements.overlayTitle.style.color = type === 'error' ? 'var(--red)' : 'var(--cyan)';
                }, 1000);
            }
        };

        // Start system
        window.onload = () => Game.init();
    </script>
</body>
</html>
